(()=>{"use strict";var t=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function c(t){try{a(o.next(t))}catch(t){r(t)}}function s(t){try{a(o.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}a((o=o.apply(t,e||[])).next())}))};class e{static set(e,n){return t(this,void 0,void 0,(function*(){chrome.storage.local.set({[e]:n})}))}static get(e,n){return t(this,void 0,void 0,(function*(){const t=yield new Promise((t=>{chrome.storage.local.get(e,(n=>{t(n[e])}))}));return void 0===t?n:t}))}static remove(e){return t(this,void 0,void 0,(function*(){chrome.storage.local.remove(e)}))}}var n=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function c(t){try{a(o.next(t))}catch(t){r(t)}}function s(t){try{a(o.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}a((o=o.apply(t,e||[])).next())}))};class o{static getLastUpdate(t){return n(this,void 0,void 0,(function*(){return this.getContent(t,"lastUpdate.txt")}))}static getData(t){return n(this,void 0,void 0,(function*(){return this.getContent(t,"data.json")}))}static getContent(t,e){return n(this,void 0,void 0,(function*(){this.timeLogger.start(e);const n=this.getURL(t,e);let o;try{o=yield fetch(n,{cache:"no-cache"})}catch(t){return console.error(`${e} をサーバから取得できませんでした。`),null}const i=yield o.text();return this.timeLogger.end(e,{size:i.length.toLocaleString()}),i}))}static getURL(t,e){return new URL(e,t).href}}o.timeLogger=new class{constructor(t){this.template=void 0!==t?t:"[$<name>] Took $<time> ms",this.timer=new Map}start(t){this.timer.set(t,performance.now())}end(t,e){if(!this.timer.has(t))return!1;const n=performance.now(),o=this.timer.get(t);return void 0===e&&(e={}),Object.assign(e,{name:t,time:Math.floor(n-o)}),console.log(this.setPlaceholder(e)),this.timer.delete(t),!0}setPlaceholder(t){let e=this.template;for(const n in t)e=e.replaceAll(`$<${n}>`,t[n].toString());return e}}('"$<name>"をサーバから$<time>ミリ秒かけて取得しました。データサイズ: $<size>バイト');const i=o;var r=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function c(t){try{a(o.next(t))}catch(t){r(t)}}function s(t){try{a(o.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}a((o=o.apply(t,e||[])).next())}))};class c{static checkUpdate(){return r(this,void 0,void 0,(function*(){this.baseURL=yield e.get("host"),(yield this.needsUpdate())?this.update()||console.log("データの更新に失敗しました: サーバがダウンしているか、サーバにファイルが存在していない可能性があります。"):console.log("データは最新の状態です。")}))}static needsUpdate(){return r(this,void 0,void 0,(function*(){const t=yield e.get("lastUpdate");if(void 0===t)return!0;const n=yield i.getLastUpdate(this.baseURL);return null!==n&&+t<+n}))}static update(){return r(this,void 0,void 0,(function*(){const t=yield i.getLastUpdate(this.baseURL);if(null===t)return!1;const n=yield i.getData(this.baseURL);return null!==n&&(e.set("lastUpdate",t),e.set("data",n),console.log("データを更新しました。"),!0)}))}}function s(){return t=this,n=void 0,i=function*(){console.log("拡張機能がアクティベートされました。"),void 0===(yield e.get("host"))&&(yield e.set("host","https://vrcalphabet.github.io/vrc-transition/")),setInterval(a,18e5),a()},new((o=void 0)||(o=Promise))((function(e,r){function c(t){try{a(i.next(t))}catch(t){r(t)}}function s(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(c,s)}a((i=i.apply(t,n||[])).next())}));var t,n,o,i}function a(){console.log("更新データを確認中..."),c.checkUpdate()}chrome.runtime.onInstalled.addListener(s),chrome.runtime.onStartup.addListener(s)})();